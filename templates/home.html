<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>ML Project â€” Predict</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
      body { background:#f8f9fa; }
      .card { box-shadow: 0 2px 6px rgba(0,0,0,0.08); }
      .feature-label { font-size:0.9rem; }
      .result { font-weight:600; font-size:1.2rem; }
    </style>
  </head>
  <body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
      <div class="container-fluid">
        <a class="navbar-brand" href="#">ML End-to-end</a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#nav" aria-controls="nav" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="nav">
          <ul class="navbar-nav ms-auto">
            <li class="nav-item"><a class="nav-link" href="#about">About</a></li>
            <li class="nav-item"><a class="nav-link" href="#predict">Predict</a></li>
          </ul>
        </div>
      </div>
    </nav>

    <main class="container my-5">
      <div class="row g-4">
        <div class="col-lg-7">
          <div class="card p-4">
            <h4 class="mb-3">Prediction dashboard</h4>
            <p class="text-muted">Enter feature values for a single sample and click <strong>Predict</strong>. The app will call the prediction API and show the result below.</p>

            <form id="predict-form">
              <div class="row g-3">
                <div class="col-6">
                  <label class="feature-label">MedInc</label>
                  <input class="form-control" id="MedInc" type="number" step="any" placeholder="e.g. 8.3252">
                </div>
                <div class="col-6">
                  <label class="feature-label">HouseAge</label>
                  <input class="form-control" id="HouseAge" type="number" step="any" placeholder="e.g. 41">
                </div>
                <div class="col-6">
                  <label class="feature-label">AveRooms</label>
                  <input class="form-control" id="AveRooms" type="number" step="any" placeholder="e.g. 6.9841">
                </div>
                <div class="col-6">
                  <label class="feature-label">AveBedrms</label>
                  <input class="form-control" id="AveBedrms" type="number" step="any" placeholder="e.g. 1.0238">
                </div>
                <div class="col-6">
                  <label class="feature-label">Population</label>
                  <input class="form-control" id="Population" type="number" step="any" placeholder="e.g. 322">
                </div>
                <div class="col-6">
                  <label class="feature-label">AveOccup</label>
                  <input class="form-control" id="AveOccup" type="number" step="any" placeholder="e.g. 2.5556">
                </div>
                <div class="col-6">
                  <label class="feature-label">Latitude</label>
                  <input class="form-control" id="Latitude" type="number" step="any" placeholder="e.g. 37.88">
                </div>
                <div class="col-6">
                  <label class="feature-label">Longitude</label>
                  <input class="form-control" id="Longitude" type="number" step="any" placeholder="e.g. -122.23">
                </div>
              </div>

              <div class="d-flex gap-2 mt-4">
                <button id="predict-btn" type="submit" class="btn btn-primary">Predict</button>
                <button id="sample-btn" type="button" class="btn btn-outline-secondary">Use sample</button>
                <button id="clear-btn" type="button" class="btn btn-outline-danger">Clear</button>
              </div>
            </form>

            <div class="mt-4">
              <div id="status" class="text-muted">Status: idle</div>
              <div id="result" class="mt-3"></div>
            </div>
          </div>
        </div>

        <div class="col-lg-5">
          <div class="card p-4">
            <h5>Model info</h5>
            <p class="text-muted">This interface posts JSON to <code>/predict_api</code>. The server expects features in the following order:</p>
            <ul>
              <li>MedInc, HouseAge, AveRooms, AveBedrms, Population, AveOccup, Latitude, Longitude</li>
            </ul>
            <hr>
            <h6>Tips</h6>
            <ul>
              <li>Send numeric values only.</li>
              <li>If your model was trained with scaling, ensure the server loads the scaler or a pipeline.</li>
              <li>Use the sample button to prefill typical values.</li>
            </ul>
          </div>
        </div>
      </div>
    </main>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script>
      const featureOrder = ['MedInc','HouseAge','AveRooms','AveBedrms','Population','AveOccup','Latitude','Longitude'];

      function readForm(){
        const obj = {};
        for(const name of featureOrder){
          const el = document.getElementById(name);
          const v = el.value;
          obj[name] = v === '' ? null : Number(v);
        }
        return obj;
      }

      document.getElementById('sample-btn').addEventListener('click', ()=>{
        const sample = [8.3252,41,6.9841,1.0238,322,2.5556,37.88,-122.23];
        featureOrder.forEach((name,i)=> document.getElementById(name).value = sample[i]);
      });

      document.getElementById('clear-btn').addEventListener('click', ()=>{
        featureOrder.forEach(name=> document.getElementById(name).value = '');
        document.getElementById('result').innerHTML='';
        document.getElementById('status').textContent = 'Status: idle';
      });

      document.getElementById('predict-form').addEventListener('submit', async (e)=>{
        e.preventDefault();
        const btn = document.getElementById('predict-btn');
        btn.disabled = true;
        document.getElementById('status').textContent = 'Status: calling API...';
        const payload = { data: readForm() };
        try{
          const resp = await fetch('/predict_api', {
            method: 'POST', headers: {'Content-Type':'application/json'}, body: JSON.stringify(payload)
          });
          const json = await resp.json();
          if(!resp.ok){
            document.getElementById('result').innerHTML = `<div class="text-danger">Error: ${json.error || resp.statusText}</div>`;
          } else {
            document.getElementById('result').innerHTML = `<div class="alert alert-success">Prediction: <span class="result">${JSON.stringify(json.predictions)}</span></div>`;
            document.getElementById('status').textContent = 'Status: success';
          }
        }catch(err){
          document.getElementById('result').innerHTML = `<div class="text-danger">Request failed: ${err.message}</div>`;
          document.getElementById('status').textContent = 'Status: failed';
        }finally{ btn.disabled=false; }
      });
    </script>
  </body>
</html>
